# HTTP/2:如何提升网络速度
HTTP/1.1优化网络效率的三种方式：  
1. 增加持久连接
2. 浏览器为每个域名最多同时维护6个TCP持久连接
3. 使用CDN的实现域名分片机制

## HTTP/1.1的主要问题
**对带宽的利用率不理想**  

带宽是指每秒最大能发送或者接收的字节数，最大字节数为**上行带宽**，最小字节数为**下行带宽**

### 三个原因导致
1. TCP的慢启动
2. 同时开启了多条TCP连接，那么这些连接会竞争固定的带宽
3. HTTP/1.1队头阻塞的问题


一旦一个TCP连接建立后，就进入发送数据状态，刚开始TCP协议会采用一个非常慢的速度去发送数据，然后慢慢加快数据的速度，直到发送数据的速度达到一个理想状态，这个称为**慢启动**。这样推迟了首次渲染页面的时长

## HTTP/2的多路复用
**一个域名只使用一个TCP长连接和消除队头阻塞问题**  

![](img/多路复用.png)

### 多路复用的实现
![](img/HTTP2协议栈.png)  

- 首先，浏览器准备好请求数据，包括了请求行、请求头等消息，如果是POST方法，那么还要有请求体
- 这些数据经过**二进制分帧层**处理后，会被转换为一个个带有**请求ID编号**的帧，通过协议栈将这些帧发送给服务器
- 服务器接收到所有帧后，会将所有相同ID的帧合并为一条完整的请求消息
- 然后服务器接收到所有帧之后，会将所有相同ID的帧合并为一条完整的请求消息
- 然后服务器处理该条请求，并将处理的响应行、响应头和响应体分别发送至二进制分帧层
- 二进制分帧层会将这些响应数据转换为一个个带有请求ID编号的帧，经过协议发送给浏览器
- 浏览器接收到响应帧后，会根据ID编号将帧的数据提交给对应的请求


通过这种分帧技术，当接收到优先级较高的请求时(如JS或CSS等关键资源时)，服务器可以暂停之前的请求来优先处理关键资源的请求

## HTTP/2其他特性
### 1.可以设置请求的优先级
### 2.服务器推送
当用户请求一个HTML页面后，服务器知道该HTML页面会引用几个重要的JS文件和CSS文件，那么服务器会将其附带发送给浏览器，提升了首次打开页面的速度
### 3.头部压缩
对请求头和响应头进行压缩
# 编译器和解释器：V8是如何执行一段JS代码的
- 编译器(Compiler)
- 解释器(Interpreter)
- 抽象语法树(AST)
- 字节码(Bytecode)
- 即时编译器(JIT)

## 编译器和解释器
![](img/编译器和解释器.png)

## V8如何执行JS
![](img/V8执行代码.png)  

1. 生成抽象语法树(AST)和执行上下文
2. 生成字节码
3. 执行代码


### 生成抽象语法树(AST)和执行上下文

```
var myName = " 极客时间 "
function foo(){
  return 23;
}
myName = "geektime"
foo()

```
这段代码经过javascript-ast站点处理后，生成的AST结构  

![](img/AST.png)  

Babel和ESLint都利用了代码和AST间的转换  

**生成AST需要经过的两个阶段**  
1. 分词(tokenize)，又称为词法分析。作用是将一行行的源码拆解成一个个token(语法上不可能再分的、最小的单个字符或字符串)  

![](img/词法分析.png)  

2. 解析(parse),又称语法分析。作用是将上一步生成的token数据，根据语法规则转换为AST。


### 生成字节码
**字节码就是介于AST和机器码之间的一种代码。但是与特定类型的机器码无关，字节码需要通过解释器将其转换为机器码后才能执行**  

![](img/占用内存对比.png)

### 执行代码
![](img/JIT.png)  

在执行代码的过程中发现热点代码(HotSpot)(一段代码被重复执行多次)，那么后台的编译器TurboFan就会把该段热点的字节码编译为高效的机器码。

## JS的性能优化
1. 提升单次脚本的执行速度，避免JS的长任务霸占主线程，这样可以使得页面快速响应交互
2. 避免大的内联脚本，因为在解析HTML的过程中，解析和编译也会占用主线程
3. 减少JS文件的容量，因为更小的文件会提升下载速度，并且占用更低的内存